<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css"
    />
    <link
      rel="stylesheet"
      href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>

    <!-- json data  -->
    <script src="data.json"></script>

    <script>
      $(function () {
        var _treeNode = $("div:nth-child(2)").find("div");
        var _searchNode = $("div:nth-child(2)").find("input");

        var defaultPlugins = ["checkbox", "search", "wholerow"];
        var myTree = _treeNode.jstree({
          plugins: defaultPlugins, // checkbox 와 search 플러그인 적용 whoerow -> 칸 나누는 효과
          checkbox: {
            keep_selected_style: false,
          },
          core: { data: Parms },
        });

        // dialogButton widget
        $.widget("custom.dialogButton", {
          defaultStyle: {
            cursor: "hand",
            "font-size": "2em",
            "border-radius": "10px",
            border: "1px solid",
            "background-color": "#2980b9",
            color: "white",
          },

          options: {},

          _create: function () {
            this.element.addClass("custom-button");

            this.dialogBtn = $("<button>", {
              text: "Dialog Button",
              class: "dialogbtn",
            })
              .appendTo(this.element)
              .css(this.defaultStyle);
          },
        });
        // dialogButton widget - end

        // myDialog widgetvar
        $.widget("custom.myDialog", $.ui.dialog, {
          options: {
            autoOpen: false, // 숨기기
            modal: false, //모달대화상자
            title: "조직 검색",
            position: top,
            width: 500,
            height: 700,
            show: {
              duration: 300,
            },

            hide: {
              duration: 300,
            },
            buttons: [
              {
                // 확인 btn - alert창 정보 출력
                text: "확인",
                click: function () {
                  var nodeID = _treeNode.jstree("get_checked"); //jstree('get_checked') : 체크된 노드의 id 값을 배열로 받아온다 nodeID 는 배열
                  _searchNode.val("");
                  if (nodeID.length == 0) {
                    alert("Are you checked?");
                  } else {
                    var message = ""; //[];
                    $.each(nodeID, function (index, items) {
                      // each 문 첫번째 인자 : 배열 객체 / 두번째 인자 콜백함수(index,item)
                      var nodeInfo = _treeNode.jstree("get_node", items).text; //jstree('get_node',nodeId) - 노드 id 로 노드정보를 검색하는 메소드
                      message += nodeInfo + "\n";
                    });
                    alert(message);
                  }
                },
              },

              {
                // 취소 btn - jstree reset
                text: "취소",
                click: function () {
                  _treeNode.jstree("deselect_all");
                  _searchNode.val("");
                },
              },
            ], // buttons
          },
        });
        // mydialog widget - end

        //enter - search 기능
        _searchNode.keyup(function (key) {
          if (key.keyCode == 13) {
            _treeNode.find(".jstree-search").trigger("click"); // 선택
          }
          var to = false;
          if (to) {
            clearTimeout(to);
          }
          to = setTimeout(function () {
            var v = _searchNode.val();
            _treeNode.jstree(true).search(v);
          }, 250);
        });
        // enter -end

        //클릭 호출
        $("#open-btn").dialogButton();

        var bar = $(".hi").myDialog();
        $("#open-btn").on("click", function () {
          bar.myDialog("open");
        });

        // jstree
        $("#tree").jstree();
        $("#tree").jstree("open_all");
      });

      // $ -end
    </script>
  </head>
  <body>
    <div id="open-btn"></div>
    <div class="hi" id="hi">
      <input type="text" />
      <div id="tree"></div>
    </div>
  </body>
</html>
